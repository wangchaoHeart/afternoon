"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[866],{84010:function(Y,j,t){t.r(j),t.d(j,{default:function(){return se}});var Q=t(90228),y=t.n(Q),X=t(87999),w=t.n(X),$=t(48305),O=t.n($),c=t(75271),I=t(21516),g=t(40297),T=t(72683),A=t(38333),p=t(70606),u=t(50489),F=t(72310),L=t(93200),_=t(57099),U=t(14218),J=t(97451),Z=t(82661),k=t(63710),q=t(31335),ee=t(8797),te=t(86743),ne=t(83572),ae=t(64297),n=t(56648),e=t(52676),m=g.Z.Title,l=g.Z.Text,N=T.Z.TabPane;function se(){var o=(0,I.useModel)("vote"),P=o.options,f=o.votes,oe=o.hasVoted,r=o.userVote,h=o.loading,re=o.addOption,ue=o.vote,_e=o.connectWebSocket,le=o.deleteOption,E=o.voteHistory,de=o.fetchVoteHistory,ie=(0,c.useState)(""),b=O()(ie,2),B=b[0],R=b[1],ce=(0,c.useState)((r==null?void 0:r.option)||""),S=O()(ce,2),v=S[0],W=S[1],me=(0,c.useState)("1"),K=O()(me,2),C=K[0],he=K[1],Ee=(0,c.useState)(!1),V=O()(Ee,2),ve=V[0],H=V[1];(0,c.useEffect)(function(){_e()},[]),(0,c.useEffect)(function(){C==="2"&&(!E||E.length===0)&&xe()},[C]);var xe=function(){var d=w()(y()().mark(function s(){return y()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return H(!0),i.next=3,de();case 3:H(!1);case 4:case"end":return i.stop()}},s)}));return function(){return d.apply(this,arguments)}}(),G=function(){if(!B.trim()){A.ZP.warning("\u9009\u9879\u4E0D\u80FD\u4E3A\u7A7A");return}re(B.trim()),R("")},De=function(){I.history.push("/voters")},je=function(){if(!v){A.ZP.warning("\u8BF7\u9009\u62E9\u4E00\u4E2A\u9009\u9879");return}ue(v)},Oe=function(s){le(s),v===s&&W("")},Ze=function(){return Object.values(f).reduce(function(s,a){return s+Number(a)},0)},M=Ze(),Pe=new Date().toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}),fe=function(){return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:n.Z.dateInfo,children:(0,e.jsxs)(l,{type:"secondary",children:["\u4ECA\u65E5\u65E5\u671F: ",Pe]})}),h?(0,e.jsxs)("div",{className:n.Z.loading,children:[(0,e.jsx)(p.Z,{size:"large"}),(0,e.jsx)(l,{className:n.Z.loadingText,children:"\u52A0\u8F7D\u4E2D..."})]}):oe?(0,e.jsxs)("div",{className:n.Z.results,children:[(0,e.jsx)(m,{level:4,children:"\u6295\u7968\u7ED3\u679C"}),(0,e.jsxs)(l,{type:"secondary",children:["\u603B\u6295\u7968\u6570: ",M]}),(0,e.jsx)(u.Z,{itemLayout:"horizontal",dataSource:P,renderItem:function(a){return(0,e.jsx)(u.Z.Item,{children:(0,e.jsx)(u.Z.Item.Meta,{title:a,description:(0,e.jsx)(F.Z,{percent:M?Math.round((f[a]||0)/M*100):0,format:function(x){return"".concat(f[a]||0," \u7968 (").concat(x,"%)")}})})})}}),r&&(0,e.jsxs)("div",{className:n.Z.voterInfo,children:[(0,e.jsx)(L.Z,{children:"\u60A8\u7684\u6295\u7968\u4FE1\u606F"}),(0,e.jsxs)(_.Z,{column:1,bordered:!0,children:[(0,e.jsx)(_.Z.Item,{label:"\u60A8\u7684\u9009\u62E9",children:r.option}),(0,e.jsx)(_.Z.Item,{label:"IP \u5730\u5740",children:r.ip}),(0,e.jsx)(_.Z.Item,{label:"\u6295\u7968\u65F6\u95F4",children:new Date(r.timestamp).toLocaleString()}),(0,e.jsx)(_.Z.Item,{label:"\u6D4F\u89C8\u5668",children:r.browser}),(0,e.jsx)(_.Z.Item,{label:"\u64CD\u4F5C\u7CFB\u7EDF",children:r.os}),(0,e.jsx)(_.Z.Item,{label:"\u8BBE\u5907",children:r.device}),(0,e.jsx)(_.Z.Item,{label:"User-Agent",children:r.ua})]})]}),(0,e.jsx)(l,{type:"secondary",className:n.Z.thankYou,children:"\u611F\u8C22\u60A8\u7684\u53C2\u4E0E\uFF01"})]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:n.Z.voteSection,children:[(0,e.jsx)(m,{level:4,children:"\u8BF7\u9009\u62E9\u60A8\u559C\u6B22\u7684\u4E0B\u5348\u8336:"}),P.length===0?(0,e.jsx)("div",{className:n.Z.emptyOptions,children:(0,e.jsx)(l,{type:"secondary",children:"\u4ECA\u5929\u8FD8\u6CA1\u6709\u6DFB\u52A0\u9009\u9879\uFF0C\u8BF7\u6DFB\u52A0\u65B0\u9009\u9879\u3002"})}):(0,e.jsx)(U.ZP.Group,{onChange:function(a){return W(a.target.value)},value:v,className:n.Z.radioGroup,children:P.map(function(s){return(0,e.jsxs)("div",{className:n.Z.optionItem,children:[(0,e.jsx)(U.ZP,{value:s,className:n.Z.radioOption,children:s}),(0,e.jsx)(J.Z,{title:"\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u4E2A\u9009\u9879\u5417\uFF1F",onConfirm:function(){return Oe(s)},okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88",children:(0,e.jsx)(Z.ZP,{type:"text",danger:!0,icon:(0,e.jsx)(te.Z,{}),className:n.Z.deleteBtn})})]},s)})}),(0,e.jsx)(Z.ZP,{type:"primary",onClick:je,disabled:!v||h||P.length===0,className:n.Z.voteButton,loading:h,children:"\u6295\u7968"})]}),(0,e.jsx)(L.Z,{}),(0,e.jsxs)("div",{className:n.Z.addSection,children:[(0,e.jsx)(m,{level:4,children:"\u6DFB\u52A0\u65B0\u9009\u9879:"}),(0,e.jsxs)(k.Z.Compact,{style:{width:"100%"},children:[(0,e.jsx)(q.Z,{value:B,onChange:function(a){return R(a.target.value)},placeholder:"\u8F93\u5165\u65B0\u9009\u9879\uFF0C\u5982\uFF1A\u73CD\u73E0\u5976\u8336",onPressEnter:G,disabled:h}),(0,e.jsx)(Z.ZP,{type:"primary",onClick:G,loading:h,children:"\u6DFB\u52A0"})]})]})]})]})},Be=function(){return(0,e.jsx)("div",{className:n.Z.historyContainer,children:ve?(0,e.jsxs)("div",{className:n.Z.loading,children:[(0,e.jsx)(p.Z,{size:"large"}),(0,e.jsx)(l,{className:n.Z.loadingText,children:"\u52A0\u8F7D\u5386\u53F2\u6570\u636E\u4E2D..."})]}):E&&E.length>0?(0,e.jsx)(u.Z,{itemLayout:"vertical",dataSource:E,renderItem:function(a){var i=new Date(a.date).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}),x=Object.values(a.votes).reduce(function(z,D){return z+Number(D)},0);return(0,e.jsxs)(u.Z.Item,{className:n.Z.historyItem,children:[(0,e.jsx)(m,{level:4,children:i}),(0,e.jsxs)(l,{type:"secondary",children:["\u603B\u6295\u7968\u6570: ",x]}),(0,e.jsx)(u.Z,{size:"small",dataSource:a.options,renderItem:function(D){return(0,e.jsx)(u.Z.Item,{children:(0,e.jsx)(u.Z.Item.Meta,{title:D,description:(0,e.jsx)(F.Z,{percent:x?Math.round((a.votes[D]||0)/x*100):0,format:function(Ce){return"".concat(a.votes[D]||0," \u7968 (").concat(Ce,"%)")},size:"small"})})})}})]})}}):(0,e.jsx)("div",{className:n.Z.emptyHistory,children:(0,e.jsx)(l,{type:"secondary",children:"\u6682\u65E0\u5386\u53F2\u8BB0\u5F55"})})})};return(0,e.jsx)("div",{className:n.Z.container,children:(0,e.jsxs)(ee.Z,{className:n.Z.card,children:[(0,e.jsxs)("div",{className:n.Z.header,children:[(0,e.jsx)(m,{level:2,className:n.Z.title,children:"\u4E0B\u5348\u8336\u6295\u7968"}),(0,e.jsx)(Z.ZP,{type:"link",icon:(0,e.jsx)(ne.Z,{}),onClick:De,className:n.Z.viewVotersButton,children:"\u67E5\u770B\u6295\u7968\u5217\u8868"})]}),(0,e.jsxs)(T.Z,{activeKey:C,onChange:he,className:n.Z.tabs,children:[(0,e.jsx)(N,{tab:(0,e.jsx)("span",{children:"\u4ECA\u65E5\u6295\u7968"}),children:fe()},"1"),(0,e.jsx)(N,{tab:(0,e.jsxs)("span",{children:[(0,e.jsx)(ae.Z,{})," \u5386\u53F2\u8BB0\u5F55"]}),children:Be()},"2")]})]})})}},56648:function(Y,j){j.Z={container:"container___lGekF",card:"card___ZgVDF",title:"title___nwRif",tabs:"tabs___LxTFv",dateInfo:"dateInfo___mun5Z",loading:"loading___v87br",loadingText:"loadingText___eet6k",results:"results___cVIlX",voteSection:"voteSection___gBRl3",radioGroup:"radioGroup___Nkqxl",optionItem:"optionItem___k9QgT",radioOption:"radioOption___Pm5Mm",deleteBtn:"deleteBtn___tYsTG",voteButton:"voteButton___Hf89i",addSection:"addSection___jmLac",thankYou:"thankYou___BQFDN",historyContainer:"historyContainer___Q7Zsd",historyItem:"historyItem___YY_Hj",emptyOptions:"emptyOptions___ywXqh",emptyHistory:"emptyHistory___o9bAS",voterInfo:"voterInfo___n0FwQ",header:"header___Peyd6",viewVotersButton:"viewVotersButton___hZCOe"}}}]);
